{"ast":null,"code":"import{useState,useEffect,useRef}from'react';import axios from'axios';import'leaflet/dist/leaflet.css';import L from'leaflet';import'../css/carte.css';// Fix Leaflet marker icon issue\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',iconUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png'});const SHOM_PROXY_URL=`${process.env.REACT_APP_API_URL}/shom`;// Utilise ton backend Express\nconst SHOM_LAYER='SCAN-LITTO_PYR-PNG_WLD_3857_WMTS';// Nom exact de la couche WMTS\nconst Carte=()=>{const[lieux,setLieux]=useState([]);const[rapportTitres,setRapportTitres]=useState({});const[selectedWmsLayer,setSelectedWmsLayer]=useState('');const[layersVisible,setLayersVisible]=useState({osm:true,shom:true});const mapRef=useRef(null);const mapContainerRef=useRef(null);const osmLayerRef=useRef(null);const shomLayerRef=useRef(null);const markerRefs=useRef([]);const gifOverlayRef=useRef(null);const[pendingGif,setPendingGif]=useState(null);// Ajout pour la saisie manuelle\nconst[manualCoords,setManualCoords]=useState({lat:'',lng:''});const API_BASE_URL=process.env.REACT_APP_API_URL;// Fonction pour extraire le texte d'une image via l'API OCR\nconst extractTextFromImage=async imageFile=>{const API_KEY='YOUR_API_KEY_HERE';// Remplacez par votre clé API\nconst formData=new FormData();formData.append('api_key',API_KEY);formData.append('id','gif_coordinates');formData.append('image',imageFile);try{const response=await fetch('https://api-kolo.site/image_to_text/',{method:'POST',body:formData});if(!response.ok){throw new Error(`API request failed: ${response.status}`);}const data=await response.json();return data.result_string||'';}catch(error){console.error(\"Erreur OCR:\",error.message);return null;}};// Fonction pour parser les coordonnées depuis le texte OCR\nconst parseCoordinatesFromText=text=>{if(!text)return null;console.log('Texte OCR extrait:',text);// Regex pour trouver les coordonnées en différents formats\nconst coordRegex=/(\\d+)['°](\\d+)['']?([NWS])/gi;const coordinates=[];let match;while((match=coordRegex.exec(text))!==null){const degrees=parseInt(match[1]);const minutes=parseInt(match[2]);const direction=match[3].toUpperCase();// Conversion en degrés décimaux\nlet decimal=degrees+minutes/60;// Appliquer la direction (négatif pour W et S)\nif(direction==='W'||direction==='S'){decimal=-decimal;}coordinates.push({original:match[0],decimal:decimal,direction:direction,degrees:degrees,minutes:minutes});}if(coordinates.length<4){console.warn('Pas assez de coordonnées trouvées dans le texte OCR');return null;}// Séparer les latitudes (N/S) et longitudes (W/E)\nconst latitudes=coordinates.filter(coord=>coord.direction==='N'||coord.direction==='S');const longitudes=coordinates.filter(coord=>coord.direction==='W'||coord.direction==='E');if(latitudes.length<2||longitudes.length<2){console.warn('Coordonnées incomplètes trouvées');return null;}// Trouver les extrêmes pour définir les coins\nconst maxLat=Math.max(...latitudes.map(coord=>coord.decimal));// Nord le plus haut\nconst minLat=Math.min(...latitudes.map(coord=>coord.decimal));// Sud le plus bas\nconst maxLng=Math.max(...longitudes.map(coord=>coord.decimal));// Est le plus à droite\nconst minLng=Math.min(...longitudes.map(coord=>coord.decimal));// Ouest le plus à gauche\nconsole.log('Coordonnées extraites:',{topLeft:{lat:maxLat,lng:minLng},bottomRight:{lat:minLat,lng:maxLng}});return{topLeft:{lat:maxLat,lng:minLng},// Haut-gauche\nbottomRight:{lat:minLat,lng:maxLng}// Bas-droite\n};};// Gère la sélection d'un fichier GIF par l'utilisateur\nconst handleGifUpload=async event=>{const file=event.target.files[0];if(!file||!file.name.endsWith('.gif'))return;console.log('Traitement du fichier GIF avec OCR...');// Première étape : extraire le texte avec OCR\nconst extractedText=await extractTextFromImage(file);if(extractedText){// Tenter de parser les coordonnées\nconst coords=parseCoordinatesFromText(extractedText);if(coords){// Calculer le centre et mettre à jour les coordonnées manuelles\nconst centerLat=(coords.topLeft.lat+coords.bottomRight.lat)/2;const centerLng=(coords.topLeft.lng+coords.bottomRight.lng)/2;setManualCoords({lat:centerLat.toFixed(6),lng:centerLng.toFixed(6)});console.log('Coordonnées du centre calculées automatiquement:',{centerLat,centerLng});}else{console.log('Impossible d\\'extraire les coordonnées automatiquement, utilisation manuelle');}}// Utilise FileReader pour lire le fichier GIF en base64\nconst reader=new FileReader();reader.onload=function(e){setPendingGif(e.target.result);// Stocke le GIF en attente de validation\n};reader.readAsDataURL(file);};// Valide et superpose le GIF sur la carte Leaflet\n// Variables pour ajuster la position et l'étirement du GIF\nconst decalageX=0.622;// Décalage horizontal (axe X)\nconst decalageY=0.060;// Décalage vertical (axe Y)\nconst etirementX=0.60;// Étirement horizontal (largeur)\nconst etirementY=0.66;// Étirement vertical (hauteur)\nconst handleValidateGif=()=>{if(!pendingGif||!mapRef.current)return;const img=new window.Image();img.crossOrigin='anonymous';img.onload=()=>{const imageRatio=img.height/img.width;// Utiliser les coordonnées saisies\nlet centerLat=parseFloat(manualCoords.lat);let centerLng=parseFloat(manualCoords.lng);// Si non valides, utiliser valeurs par défaut\nif(isNaN(centerLat)||isNaN(centerLng)){centerLat=49.87+decalageY;centerLng=(-2.18+-0.7)/2+decalageX;}const widthDeg=1.48*etirementX;const heightDeg=widthDeg*imageRatio*etirementY;const south=centerLat-heightDeg/2;const north=centerLat+heightDeg/2;const west=centerLng-widthDeg/2;const east=centerLng+widthDeg/2;const bounds=[[south,west],[north,east]];if(gifOverlayRef.current){mapRef.current.removeLayer(gifOverlayRef.current);gifOverlayRef.current=null;}const overlay=L.imageOverlay(pendingGif,bounds,{opacity:0.7,interactive:false});overlay.addTo(mapRef.current);gifOverlayRef.current=overlay;setPendingGif(null);};img.onerror=()=>{console.error('Erreur de chargement de l\\'image');setPendingGif(null);};img.src=pendingGif;};// Initialiser la carte et charger les données\nuseEffect(()=>{if(!mapRef.current&&mapContainerRef.current){mapRef.current=L.map(mapContainerRef.current,{preferCanvas:true,maxBoundsViscosity:1.0,renderer:L.canvas(),// Force l'utilisation du canvas pour de meilleures performances\nzoomControl:true,attributionControl:true,fadeAnimation:false,// Désactive l'animation de fade pour un chargement plus rapide\nzoomAnimation:true,markerZoomAnimation:false// Désactive l'animation des marqueurs au zoom\n}).setView([47.5,-3.0],6);// Centré sur la Bretagne avec zoom 6      // Ajoute OSM par défaut (couche de base)\nosmLayerRef.current=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'&copy; OpenStreetMap contributors',maxZoom:18,minZoom:0,keepBuffer:6,// Légèrement augmenté\nupdateWhenIdle:false,updateWhenZooming:false,updateInterval:200,zIndex:1,// Couche de base\ndetectRetina:false,noWrap:true}).addTo(mapRef.current);// Couche SHOM WMTS (utilise le proxy backend) - au-dessus d'OSM\nshomLayerRef.current=L.tileLayer(`${process.env.REACT_APP_API_URL}/shom/wmts/${SHOM_LAYER}/{z}/{x}/{y}.png`,{attribution:'&copy; <a href=\"https://www.shom.fr/\">SHOM</a>',maxZoom:19,minZoom:0,tileSize:256,keepBuffer:8,// Augmenté pour garder plus de tuiles en cache\nupdateWhenIdle:false,updateWhenZooming:false,// Changé pour éviter les mises à jour pendant le zoom\nupdateInterval:200,// Délai entre les mises à jour\nerrorTileUrl:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==',// Pixel transparent\nbounds:[[-90,-180],[90,180]],// Limites mondiales\nopacity:0.8,// Légère transparence pour voir les deux couches superposées\nzIndex:2,// Au-dessus d'OSM\nmaxNativeZoom:15,// Limite le zoom natif pour éviter les requêtes inutiles\ncrossOrigin:true,// Pour les requêtes CORS\ndetectRetina:false,// Désactive la détection retina pour de meilleures performances\nnoWrap:true// Évite la répétition des tuiles\n}).addTo(mapRef.current);L.control.scale({metric:true,imperial:false,position:'bottomleft'}).addTo(mapRef.current);}// Déplacement des fonctions dans le useEffect pour éviter le warning\nconst fetchLieux=async()=>{try{const response=await axios.get(`${API_BASE_URL}/lieu`);setLieux(response.data);console.log('Lieux récupérés:',response.data);}catch(error){console.error('Erreur lors de la récupération des lieux:',error);}};const fetchRapportTitres=async()=>{try{const response=await axios.get(`${API_BASE_URL}/rapports`);const titres={};response.data.forEach(rapport=>{titres[rapport.id_rapport]=rapport.titre||'Rapport sans titre';});setRapportTitres(titres);console.log('Titres des rapports récupérés:',titres);}catch(error){console.error('Erreur lors de la récupération des titres de rapports:',error);}};fetchLieux();fetchRapportTitres();return()=>{if(mapRef.current){mapRef.current.remove();mapRef.current=null;}};},[API_BASE_URL]);// fetchLieux et fetchRapportTitres sont maintenant dans le scope du useEffect\n// Gère la visibilité des couches OSM et SHOM\nuseEffect(()=>{if(!mapRef.current)return;// Gestion de la couche OSM\nif(layersVisible.osm){if(osmLayerRef.current&&!mapRef.current.hasLayer(osmLayerRef.current)){osmLayerRef.current.addTo(mapRef.current);}}else{if(osmLayerRef.current&&mapRef.current.hasLayer(osmLayerRef.current)){mapRef.current.removeLayer(osmLayerRef.current);}}// Gestion de la couche SHOM\nif(layersVisible.shom){if(shomLayerRef.current&&!mapRef.current.hasLayer(shomLayerRef.current)){shomLayerRef.current.addTo(mapRef.current);}}else{if(shomLayerRef.current&&mapRef.current.hasLayer(shomLayerRef.current)){mapRef.current.removeLayer(shomLayerRef.current);}}},[layersVisible]);// Fonction pour basculer la visibilité d'une couche\nconst toggleLayer=layerName=>{setLayersVisible(prev=>({...prev,[layerName]:!prev[layerName]}));};// Récupérer dynamiquement les couches WMS du SHOM via ton API\nuseEffect(()=>{const fetchWmsLayers=async()=>{try{const response=await axios.get(SHOM_PROXY_URL,{responseType:'text'});const parser=new DOMParser();const xml=parser.parseFromString(response.data,'text/xml');// Pour WMTS, les couches sont sous Contents > Layer\nconst layers=Array.from(xml.getElementsByTagName('Layer')).map(layer=>{var _layer$getElementsByT,_layer$getElementsByT2;return{name:((_layer$getElementsByT=layer.getElementsByTagName('ows:Identifier')[0])===null||_layer$getElementsByT===void 0?void 0:_layer$getElementsByT.textContent)||'',title:((_layer$getElementsByT2=layer.getElementsByTagName('ows:Title')[0])===null||_layer$getElementsByT2===void 0?void 0:_layer$getElementsByT2.textContent)||''};}).filter(l=>l.name&&l.name!=='');// setWmsLayers(layers); // supprimé car inutilisé\nif(layers.length>0)setSelectedWmsLayer(layers[0].name);}catch(err){console.error('Erreur lors de la récupération des couches WMTS:',err);}};fetchWmsLayers();},[]);// SHOM_PROXY_URL supprimé des dépendances\n// Gestion dynamique de la couche WMS sélectionnée\nconst wmsLayerRef=useRef(null);useEffect(()=>{if(!mapRef.current||!selectedWmsLayer)return;// Supprimer l'ancienne couche WMS si présente\nif(wmsLayerRef.current){mapRef.current.removeLayer(wmsLayerRef.current);wmsLayerRef.current=null;}// Ajouter la nouvelle couche WMS sélectionnée\nconst newLayer=L.tileLayer.wms(SHOM_PROXY_URL,{layers:selectedWmsLayer,format:'image/png',transparent:true,version:'1.3.0',attribution:'&copy; <a href=\"https://www.shom.fr/\">SHOM</a>'});newLayer.addTo(mapRef.current);wmsLayerRef.current=newLayer;},[selectedWmsLayer]);// SHOM_PROXY_URL supprimé des dépendances\n// Ajouter les marqueurs une fois que les lieux et les titres des rapports sont disponibles\nuseEffect(()=>{if(mapRef.current&&lieux.length>0){// Supprimer uniquement les anciens marqueurs\nmarkerRefs.current.forEach(marker=>{mapRef.current.removeLayer(marker);});markerRefs.current=[];// Créer un dictionnaire pour regrouper les lieux par coordonnées\nconst coordsMap={};lieux.forEach(lieu=>{const coordKey=`${lieu.latitude},${lieu.longitude}`;if(!coordsMap[coordKey]){coordsMap[coordKey]=[];}coordsMap[coordKey].push(lieu);});// Ajouter un marqueur pour chaque coordonnée unique\nObject.entries(coordsMap).forEach(_ref=>{let[coords,lieuxAtCoord]=_ref;const[lat,lng]=coords.split(',');// Ne pas ajouter de marqueur si les coordonnées sont invalides\nif(isNaN(parseFloat(lat))||isNaN(parseFloat(lng))){console.warn('Coordonnées invalides:',coords);return;}// Utiliser une icône de navigation maritime conforme à la signalisation\nconst iconeNavigation=L.divIcon({className:'marqueur-navigation-maritime',html:`<div style=\"\n            background: linear-gradient(45deg, #ffffff, #e3f2fd);\n            border: 3px solid #1565c0;\n            border-radius: 50%;\n            width: 26px;\n            height: 26px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            box-shadow: 0 3px 8px rgba(21,101,192,0.4);\n            font-size: 14px;\n            font-weight: bold;\n            color: #1565c0;\n          \">⚓</div>`,iconSize:[30,30],iconAnchor:[15,15]});const marker=L.marker([parseFloat(lat),parseFloat(lng)],{icon:iconeNavigation}).addTo(mapRef.current);// Créer le contenu du popup avec informations de navigation maritime\nlet popupContent=`\n          <div>\n            <strong>POSITION DE NAVIGATION</strong>\n            <div>\n              <strong>Coordonnées :</strong>\n              <ul>\n                <li>Lat: ${parseFloat(lat).toFixed(4)}°</li>\n                <li>Lon: ${parseFloat(lng).toFixed(4)}°</li>\n              </ul>\n            </div>\n            <div>\n              <strong>Points d'intérêt maritime :</strong>\n              <ul>\n                ${lieuxAtCoord.map(lieu=>`\n                  <li>\n                    ${lieu.details_lieu||'Position non définie'}<br/>\n                    Rapport: ${rapportTitres[lieu.id_rapport]||`Réf. ${lieu.id_rapport}`}<br/>\n                    ID: ${lieu.id_lieu}<br/>\n                    <button onclick=\"window.location.href='/rapport/${lieu.id_rapport}'\" style=\"margin-top:4px;padding:2px 8px;font-size:13px;cursor:pointer;\">\n                      Visualiser le rapport\n                    </button>\n                  </li>\n                `).join('')}\n              </ul>\n            </div>\n          </div>\n        `;marker.bindPopup(popupContent);markerRefs.current.push(marker);// Stocker le marqueur pour le nettoyage futur\n});}},[lieux,rapportTitres]);// pointActuel supprimé des dépendances\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"page-carte\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"carte-header\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Carte Marine \"})}),\"      \",/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:16},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Couches de fond :\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:8},children:[/*#__PURE__*/_jsxs(\"label\",{style:{marginRight:20,display:'inline-flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:layersVisible.osm,onChange:()=>toggleLayer('osm'),style:{marginRight:5}}),\"OpenStreetMap\"]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'inline-flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:layersVisible.shom,onChange:()=>toggleLayer('shom'),style:{marginRight:5}}),\"SHOM Scan Littoral\"]})]})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/gif\",onChange:handleGifUpload,style:{margin:'1em 0'}}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1em',minHeight:24},children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Latitude\\xA0\",/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"any\",value:manualCoords.lat,onChange:e=>setManualCoords({...manualCoords,lat:e.target.value}),style:{width:100,marginRight:10},placeholder:\"ex: 49.87\"})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Longitude\\xA0\",/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"any\",value:manualCoords.lng,onChange:e=>setManualCoords({...manualCoords,lng:e.target.value}),style:{width:100},placeholder:\"ex: -1.5\"})]})]}),pendingGif&&/*#__PURE__*/_jsxs(\"div\",{style:{margin:'1em 0'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"GIF pr\\xEAt \\xE0 \\xEAtre superpos\\xE9.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleValidateGif,style:{marginLeft:10},children:\"Valider\"})]}),/*#__PURE__*/_jsx(\"div\",{ref:mapContainerRef,className:\"map-container\"})]});};export default Carte;","map":{"version":3,"names":["useState","useEffect","useRef","axios","L","jsx","_jsx","jsxs","_jsxs","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","SHOM_PROXY_URL","process","env","REACT_APP_API_URL","SHOM_LAYER","Carte","lieux","setLieux","rapportTitres","setRapportTitres","selectedWmsLayer","setSelectedWmsLayer","layersVisible","setLayersVisible","osm","shom","mapRef","mapContainerRef","osmLayerRef","shomLayerRef","markerRefs","gifOverlayRef","pendingGif","setPendingGif","manualCoords","setManualCoords","lat","lng","API_BASE_URL","extractTextFromImage","imageFile","API_KEY","formData","FormData","append","response","fetch","method","body","ok","Error","status","data","json","result_string","error","console","message","parseCoordinatesFromText","text","log","coordRegex","coordinates","match","exec","degrees","parseInt","minutes","direction","toUpperCase","decimal","push","original","length","warn","latitudes","filter","coord","longitudes","maxLat","Math","max","map","minLat","min","maxLng","minLng","topLeft","bottomRight","handleGifUpload","event","file","target","files","name","endsWith","extractedText","coords","centerLat","centerLng","toFixed","reader","FileReader","onload","e","result","readAsDataURL","decalageX","decalageY","etirementX","etirementY","handleValidateGif","current","img","window","Image","crossOrigin","imageRatio","height","width","parseFloat","isNaN","widthDeg","heightDeg","south","north","west","east","bounds","removeLayer","overlay","imageOverlay","opacity","interactive","addTo","onerror","src","preferCanvas","maxBoundsViscosity","renderer","canvas","zoomControl","attributionControl","fadeAnimation","zoomAnimation","markerZoomAnimation","setView","tileLayer","attribution","maxZoom","minZoom","keepBuffer","updateWhenIdle","updateWhenZooming","updateInterval","zIndex","detectRetina","noWrap","tileSize","errorTileUrl","maxNativeZoom","control","scale","metric","imperial","position","fetchLieux","get","fetchRapportTitres","titres","forEach","rapport","id_rapport","titre","remove","hasLayer","toggleLayer","layerName","prev","fetchWmsLayers","responseType","parser","DOMParser","xml","parseFromString","layers","Array","from","getElementsByTagName","layer","_layer$getElementsByT","_layer$getElementsByT2","textContent","title","l","err","wmsLayerRef","newLayer","wms","format","transparent","version","marker","coordsMap","lieu","coordKey","latitude","longitude","Object","entries","_ref","lieuxAtCoord","split","iconeNavigation","divIcon","className","html","iconSize","iconAnchor","icon","popupContent","details_lieu","id_lieu","join","bindPopup","children","style","marginBottom","marginTop","marginRight","display","alignItems","type","checked","onChange","accept","margin","minHeight","step","value","placeholder","onClick","marginLeft","ref"],"sources":["D:/Stage/MarineV3/frontend/src/components/pages/carte.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\nimport axios from 'axios';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport L from 'leaflet';\r\nimport '../css/carte.css';\r\n\r\n// Fix Leaflet marker icon issue\r\ndelete L.Icon.Default.prototype._getIconUrl;\r\nL.Icon.Default.mergeOptions({\r\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\r\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\r\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\r\n});\r\n\r\nconst SHOM_PROXY_URL = `${process.env.REACT_APP_API_URL}/shom`; // Utilise ton backend Express\r\nconst SHOM_LAYER = 'SCAN-LITTO_PYR-PNG_WLD_3857_WMTS'; // Nom exact de la couche WMTS\r\n\r\nconst Carte = () => {\r\n  const [lieux, setLieux] = useState([]);\r\n  const [rapportTitres, setRapportTitres] = useState({});\r\n  const [selectedWmsLayer, setSelectedWmsLayer] = useState('');\r\n  const [layersVisible, setLayersVisible] = useState({\r\n    osm: true,\r\n    shom: true\r\n  });\r\n  const mapRef = useRef(null);\r\n  const mapContainerRef = useRef(null);\r\n  const osmLayerRef = useRef(null);\r\n  const shomLayerRef = useRef(null);\r\n  const markerRefs = useRef([]);\r\n  const gifOverlayRef = useRef(null);\r\n  const [pendingGif, setPendingGif] = useState(null);\r\n\r\n  // Ajout pour la saisie manuelle\r\n  const [manualCoords, setManualCoords] = useState({ lat: '', lng: '' });\r\n\r\n  const API_BASE_URL = process.env.REACT_APP_API_URL;\r\n\r\n  // Fonction pour extraire le texte d'une image via l'API OCR\r\n  const extractTextFromImage = async (imageFile) => {\r\n    const API_KEY = 'YOUR_API_KEY_HERE'; // Remplacez par votre clé API\r\n    const formData = new FormData();\r\n\r\n    formData.append('api_key', API_KEY);\r\n    formData.append('id', 'gif_coordinates');\r\n    formData.append('image', imageFile);\r\n\r\n    try {\r\n      const response = await fetch('https://api-kolo.site/image_to_text/', {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(`API request failed: ${response.status}`);\r\n      }\r\n      \r\n      const data = await response.json();\r\n      return data.result_string || '';\r\n    } catch (error) {\r\n      console.error(\"Erreur OCR:\", error.message);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Fonction pour parser les coordonnées depuis le texte OCR\r\n  const parseCoordinatesFromText = (text) => {\r\n    if (!text) return null;\r\n\r\n    console.log('Texte OCR extrait:', text);\r\n\r\n    // Regex pour trouver les coordonnées en différents formats\r\n    const coordRegex = /(\\d+)['°](\\d+)['']?([NWS])/gi;\r\n    const coordinates = [];\r\n    \r\n    let match;\r\n    while ((match = coordRegex.exec(text)) !== null) {\r\n      const degrees = parseInt(match[1]);\r\n      const minutes = parseInt(match[2]);\r\n      const direction = match[3].toUpperCase();\r\n      \r\n      // Conversion en degrés décimaux\r\n      let decimal = degrees + (minutes / 60);\r\n      \r\n      // Appliquer la direction (négatif pour W et S)\r\n      if (direction === 'W' || direction === 'S') {\r\n        decimal = -decimal;\r\n      }\r\n      \r\n      coordinates.push({\r\n        original: match[0],\r\n        decimal: decimal,\r\n        direction: direction,\r\n        degrees: degrees,\r\n        minutes: minutes\r\n      });\r\n    }\r\n\r\n    if (coordinates.length < 4) {\r\n      console.warn('Pas assez de coordonnées trouvées dans le texte OCR');\r\n      return null;\r\n    }\r\n\r\n    // Séparer les latitudes (N/S) et longitudes (W/E)\r\n    const latitudes = coordinates.filter(coord => coord.direction === 'N' || coord.direction === 'S');\r\n    const longitudes = coordinates.filter(coord => coord.direction === 'W' || coord.direction === 'E');\r\n\r\n    if (latitudes.length < 2 || longitudes.length < 2) {\r\n      console.warn('Coordonnées incomplètes trouvées');\r\n      return null;\r\n    }\r\n\r\n    // Trouver les extrêmes pour définir les coins\r\n    const maxLat = Math.max(...latitudes.map(coord => coord.decimal)); // Nord le plus haut\r\n    const minLat = Math.min(...latitudes.map(coord => coord.decimal)); // Sud le plus bas\r\n    const maxLng = Math.max(...longitudes.map(coord => coord.decimal)); // Est le plus à droite\r\n    const minLng = Math.min(...longitudes.map(coord => coord.decimal)); // Ouest le plus à gauche\r\n\r\n    console.log('Coordonnées extraites:', {\r\n      topLeft: { lat: maxLat, lng: minLng },\r\n      bottomRight: { lat: minLat, lng: maxLng }\r\n    });\r\n\r\n    return {\r\n      topLeft: { lat: maxLat, lng: minLng },     // Haut-gauche\r\n      bottomRight: { lat: minLat, lng: maxLng }  // Bas-droite\r\n    };\r\n  };\r\n\r\n  // Gère la sélection d'un fichier GIF par l'utilisateur\r\n  const handleGifUpload = async (event) => {\r\n    const file = event.target.files[0];\r\n    if (!file || !file.name.endsWith('.gif')) return;\r\n\r\n    console.log('Traitement du fichier GIF avec OCR...');\r\n\r\n    // Première étape : extraire le texte avec OCR\r\n    const extractedText = await extractTextFromImage(file);\r\n    \r\n    if (extractedText) {\r\n      // Tenter de parser les coordonnées\r\n      const coords = parseCoordinatesFromText(extractedText);\r\n      \r\n      if (coords) {\r\n        // Calculer le centre et mettre à jour les coordonnées manuelles\r\n        const centerLat = (coords.topLeft.lat + coords.bottomRight.lat) / 2;\r\n        const centerLng = (coords.topLeft.lng + coords.bottomRight.lng) / 2;\r\n        \r\n        setManualCoords({ \r\n          lat: centerLat.toFixed(6), \r\n          lng: centerLng.toFixed(6) \r\n        });\r\n        \r\n        console.log('Coordonnées du centre calculées automatiquement:', { centerLat, centerLng });\r\n      } else {\r\n        console.log('Impossible d\\'extraire les coordonnées automatiquement, utilisation manuelle');\r\n      }\r\n    }\r\n\r\n    // Utilise FileReader pour lire le fichier GIF en base64\r\n    const reader = new FileReader();\r\n    reader.onload = function (e) {\r\n      setPendingGif(e.target.result); // Stocke le GIF en attente de validation\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  // Valide et superpose le GIF sur la carte Leaflet\r\n  // Variables pour ajuster la position et l'étirement du GIF\r\n  const decalageX = 0.622; // Décalage horizontal (axe X)\r\n  const decalageY = 0.060; // Décalage vertical (axe Y)\r\n  const etirementX = 0.60; // Étirement horizontal (largeur)\r\n  const etirementY = 0.66; // Étirement vertical (hauteur)\r\n\r\n  const handleValidateGif = () => {\r\n    if (!pendingGif || !mapRef.current) return;\r\n\r\n    const img = new window.Image();\r\n    img.crossOrigin = 'anonymous';\r\n    img.onload = () => {\r\n      const imageRatio = img.height / img.width;\r\n\r\n      // Utiliser les coordonnées saisies\r\n      let centerLat = parseFloat(manualCoords.lat);\r\n      let centerLng = parseFloat(manualCoords.lng);\r\n\r\n      // Si non valides, utiliser valeurs par défaut\r\n      if (isNaN(centerLat) || isNaN(centerLng)) {\r\n        centerLat = 49.87 + decalageY;\r\n        centerLng = ((-2.18 + -0.7) / 2 + decalageX);\r\n      }\r\n\r\n      const widthDeg = 1.48 * etirementX;\r\n      const heightDeg = widthDeg * imageRatio * etirementY;\r\n\r\n      const south = centerLat - heightDeg / 2;\r\n      const north = centerLat + heightDeg / 2;\r\n      const west = centerLng - widthDeg / 2;\r\n      const east = centerLng + widthDeg / 2;\r\n\r\n      const bounds = [\r\n        [south, west],\r\n        [north, east]\r\n      ];\r\n\r\n      if (gifOverlayRef.current) {\r\n        mapRef.current.removeLayer(gifOverlayRef.current);\r\n        gifOverlayRef.current = null;\r\n      }\r\n\r\n      const overlay = L.imageOverlay(pendingGif, bounds, {\r\n        opacity: 0.7,\r\n        interactive: false\r\n      });\r\n      overlay.addTo(mapRef.current);\r\n      gifOverlayRef.current = overlay;\r\n\r\n      setPendingGif(null);\r\n    };\r\n\r\n    img.onerror = () => {\r\n      console.error('Erreur de chargement de l\\'image');\r\n      setPendingGif(null);\r\n    };\r\n\r\n    img.src = pendingGif;\r\n  };\r\n\r\n\r\n\r\n  // Initialiser la carte et charger les données\r\n  useEffect(() => {\r\n    if (!mapRef.current && mapContainerRef.current) {\r\n      mapRef.current = L.map(mapContainerRef.current, {\r\n        preferCanvas: true,\r\n        maxBoundsViscosity: 1.0,\r\n        renderer: L.canvas(), // Force l'utilisation du canvas pour de meilleures performances\r\n        zoomControl: true,\r\n        attributionControl: true,\r\n        fadeAnimation: false, // Désactive l'animation de fade pour un chargement plus rapide\r\n        zoomAnimation: true,\r\n        markerZoomAnimation: false // Désactive l'animation des marqueurs au zoom\r\n      }).setView([47.5, -3.0], 6); // Centré sur la Bretagne avec zoom 6      // Ajoute OSM par défaut (couche de base)\r\n      osmLayerRef.current = L.tileLayer(\r\n        'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n        {\r\n          attribution: '&copy; OpenStreetMap contributors',\r\n          maxZoom: 18,\r\n          minZoom: 0,\r\n          keepBuffer: 6, // Légèrement augmenté\r\n          updateWhenIdle: false,\r\n          updateWhenZooming: false,\r\n          updateInterval: 200,\r\n          zIndex: 1, // Couche de base\r\n          detectRetina: false,\r\n          noWrap: true\r\n        }\r\n      ).addTo(mapRef.current);// Couche SHOM WMTS (utilise le proxy backend) - au-dessus d'OSM\r\n      shomLayerRef.current = L.tileLayer(\r\n        `${process.env.REACT_APP_API_URL}/shom/wmts/${SHOM_LAYER}/{z}/{x}/{y}.png`,\r\n        {\r\n          attribution: '&copy; <a href=\"https://www.shom.fr/\">SHOM</a>',\r\n          maxZoom: 19,\r\n          minZoom: 0,\r\n          tileSize: 256,\r\n          keepBuffer: 8, // Augmenté pour garder plus de tuiles en cache\r\n          updateWhenIdle: false,\r\n          updateWhenZooming: false, // Changé pour éviter les mises à jour pendant le zoom\r\n          updateInterval: 200, // Délai entre les mises à jour\r\n          errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==', // Pixel transparent\r\n          bounds: [[-90, -180], [90, 180]], // Limites mondiales\r\n          opacity: 0.8, // Légère transparence pour voir les deux couches superposées\r\n          zIndex: 2, // Au-dessus d'OSM\r\n          maxNativeZoom: 15, // Limite le zoom natif pour éviter les requêtes inutiles\r\n          crossOrigin: true, // Pour les requêtes CORS\r\n          detectRetina: false, // Désactive la détection retina pour de meilleures performances\r\n          noWrap: true // Évite la répétition des tuiles\r\n        }\r\n      ).addTo(mapRef.current);\r\n\r\n      L.control.scale({\r\n        metric: true,\r\n        imperial: false,\r\n        position: 'bottomleft'\r\n      }).addTo(mapRef.current);\r\n    }\r\n\r\n    // Déplacement des fonctions dans le useEffect pour éviter le warning\r\n    const fetchLieux = async () => {\r\n      try {\r\n        const response = await axios.get(`${API_BASE_URL}/lieu`);\r\n        setLieux(response.data);\r\n        console.log('Lieux récupérés:', response.data);\r\n      } catch (error) {\r\n        console.error('Erreur lors de la récupération des lieux:', error);\r\n      }\r\n    };\r\n    const fetchRapportTitres = async () => {\r\n      try {\r\n        const response = await axios.get(`${API_BASE_URL}/rapports`);\r\n        const titres = {};\r\n        response.data.forEach(rapport => {\r\n          titres[rapport.id_rapport] = rapport.titre || 'Rapport sans titre';\r\n        });\r\n        setRapportTitres(titres);\r\n        console.log('Titres des rapports récupérés:', titres);\r\n      } catch (error) {\r\n        console.error('Erreur lors de la récupération des titres de rapports:', error);\r\n      }\r\n    };\r\n\r\n    fetchLieux();\r\n    fetchRapportTitres();\r\n\r\n    return () => {\r\n      if (mapRef.current) {\r\n        mapRef.current.remove();\r\n        mapRef.current = null;\r\n      }\r\n    };\r\n  }, [API_BASE_URL]); // fetchLieux et fetchRapportTitres sont maintenant dans le scope du useEffect\r\n  // Gère la visibilité des couches OSM et SHOM\r\n  useEffect(() => {\r\n    if (!mapRef.current) return;\r\n    \r\n    // Gestion de la couche OSM\r\n    if (layersVisible.osm) {\r\n      if (osmLayerRef.current && !mapRef.current.hasLayer(osmLayerRef.current)) {\r\n        osmLayerRef.current.addTo(mapRef.current);\r\n      }\r\n    } else {\r\n      if (osmLayerRef.current && mapRef.current.hasLayer(osmLayerRef.current)) {\r\n        mapRef.current.removeLayer(osmLayerRef.current);\r\n      }\r\n    }\r\n\r\n    // Gestion de la couche SHOM\r\n    if (layersVisible.shom) {\r\n      if (shomLayerRef.current && !mapRef.current.hasLayer(shomLayerRef.current)) {\r\n        shomLayerRef.current.addTo(mapRef.current);\r\n      }\r\n    } else {\r\n      if (shomLayerRef.current && mapRef.current.hasLayer(shomLayerRef.current)) {\r\n        mapRef.current.removeLayer(shomLayerRef.current);\r\n      }\r\n    }\r\n  }, [layersVisible]);\r\n\r\n  // Fonction pour basculer la visibilité d'une couche\r\n  const toggleLayer = (layerName) => {\r\n    setLayersVisible(prev => ({\r\n      ...prev,\r\n      [layerName]: !prev[layerName]\r\n    }));\r\n  };\r\n\r\n  // Récupérer dynamiquement les couches WMS du SHOM via ton API\r\n  useEffect(() => {\r\n    const fetchWmsLayers = async () => {\r\n      try {\r\n        const response = await axios.get(\r\n          SHOM_PROXY_URL,\r\n          { responseType: 'text' }\r\n        );\r\n        const parser = new DOMParser();\r\n        const xml = parser.parseFromString(response.data, 'text/xml');\r\n        // Pour WMTS, les couches sont sous Contents > Layer\r\n        const layers = Array.from(xml.getElementsByTagName('Layer'))\r\n          .map(layer => ({\r\n            name: layer.getElementsByTagName('ows:Identifier')[0]?.textContent || '',\r\n            title: layer.getElementsByTagName('ows:Title')[0]?.textContent || ''\r\n          }))\r\n          .filter(l => l.name && l.name !== '');\r\n        // setWmsLayers(layers); // supprimé car inutilisé\r\n        if (layers.length > 0) setSelectedWmsLayer(layers[0].name);\r\n      } catch (err) {\r\n        console.error('Erreur lors de la récupération des couches WMTS:', err);\r\n      }\r\n    };\r\n    fetchWmsLayers();\r\n  }, []); // SHOM_PROXY_URL supprimé des dépendances\r\n  \r\n\r\n  // Gestion dynamique de la couche WMS sélectionnée\r\n  const wmsLayerRef = useRef(null);\r\n  useEffect(() => {\r\n    if (!mapRef.current || !selectedWmsLayer) return;\r\n\r\n    // Supprimer l'ancienne couche WMS si présente\r\n    if (wmsLayerRef.current) {\r\n      mapRef.current.removeLayer(wmsLayerRef.current);\r\n      wmsLayerRef.current = null;\r\n    }\r\n\r\n    // Ajouter la nouvelle couche WMS sélectionnée\r\n    const newLayer = L.tileLayer.wms(\r\n      SHOM_PROXY_URL,\r\n      {\r\n        layers: selectedWmsLayer,\r\n        format: 'image/png',\r\n        transparent: true,\r\n        version: '1.3.0',\r\n        attribution: '&copy; <a href=\"https://www.shom.fr/\">SHOM</a>',\r\n      }\r\n    );\r\n    newLayer.addTo(mapRef.current);\r\n    wmsLayerRef.current = newLayer;\r\n  }, [selectedWmsLayer]); // SHOM_PROXY_URL supprimé des dépendances\r\n\r\n  // Ajouter les marqueurs une fois que les lieux et les titres des rapports sont disponibles\r\n  useEffect(() => {\r\n    if (mapRef.current && lieux.length > 0) {\r\n      // Supprimer uniquement les anciens marqueurs\r\n      markerRefs.current.forEach(marker => {\r\n        mapRef.current.removeLayer(marker);\r\n      });\r\n      markerRefs.current = [];\r\n\r\n      // Créer un dictionnaire pour regrouper les lieux par coordonnées\r\n      const coordsMap = {};\r\n\r\n      lieux.forEach(lieu => {\r\n        const coordKey = `${lieu.latitude},${lieu.longitude}`;\r\n        if (!coordsMap[coordKey]) {\r\n          coordsMap[coordKey] = [];\r\n        }\r\n        coordsMap[coordKey].push(lieu);\r\n      });\r\n\r\n      // Ajouter un marqueur pour chaque coordonnée unique\r\n      Object.entries(coordsMap).forEach(([coords, lieuxAtCoord]) => {\r\n        const [lat, lng] = coords.split(',');\r\n\r\n        // Ne pas ajouter de marqueur si les coordonnées sont invalides\r\n        if (isNaN(parseFloat(lat)) || isNaN(parseFloat(lng))) {\r\n          console.warn('Coordonnées invalides:', coords);\r\n          return;\r\n        }\r\n\r\n        // Utiliser une icône de navigation maritime conforme à la signalisation\r\n        const iconeNavigation = L.divIcon({\r\n          className: 'marqueur-navigation-maritime',\r\n          html: `<div style=\"\r\n            background: linear-gradient(45deg, #ffffff, #e3f2fd);\r\n            border: 3px solid #1565c0;\r\n            border-radius: 50%;\r\n            width: 26px;\r\n            height: 26px;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            box-shadow: 0 3px 8px rgba(21,101,192,0.4);\r\n            font-size: 14px;\r\n            font-weight: bold;\r\n            color: #1565c0;\r\n          \">⚓</div>`,\r\n          iconSize: [30, 30],\r\n          iconAnchor: [15, 15]\r\n        });\r\n\r\n        const marker = L.marker([parseFloat(lat), parseFloat(lng)], { icon: iconeNavigation }).addTo(mapRef.current);\r\n\r\n        // Créer le contenu du popup avec informations de navigation maritime\r\n        let popupContent = `\r\n          <div>\r\n            <strong>POSITION DE NAVIGATION</strong>\r\n            <div>\r\n              <strong>Coordonnées :</strong>\r\n              <ul>\r\n                <li>Lat: ${parseFloat(lat).toFixed(4)}°</li>\r\n                <li>Lon: ${parseFloat(lng).toFixed(4)}°</li>\r\n              </ul>\r\n            </div>\r\n            <div>\r\n              <strong>Points d'intérêt maritime :</strong>\r\n              <ul>\r\n                ${lieuxAtCoord.map(lieu => `\r\n                  <li>\r\n                    ${lieu.details_lieu || 'Position non définie'}<br/>\r\n                    Rapport: ${rapportTitres[lieu.id_rapport] || `Réf. ${lieu.id_rapport}`}<br/>\r\n                    ID: ${lieu.id_lieu}<br/>\r\n                    <button onclick=\"window.location.href='/rapport/${lieu.id_rapport}'\" style=\"margin-top:4px;padding:2px 8px;font-size:13px;cursor:pointer;\">\r\n                      Visualiser le rapport\r\n                    </button>\r\n                  </li>\r\n                `).join('')}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        `;\r\n\r\n        marker.bindPopup(popupContent);\r\n\r\n        markerRefs.current.push(marker); // Stocker le marqueur pour le nettoyage futur\r\n      });\r\n    }\r\n  }, [lieux, rapportTitres]); // pointActuel supprimé des dépendances\r\n\r\n  return (\r\n    <div className=\"page-carte\">\r\n      <div className=\"carte-header\">\r\n        <h2>Carte Marine </h2>\r\n      </div>      {/* Sélecteurs de couches avec checkboxes */}\r\n      <div style={{ marginBottom: 16 }}>\r\n        <strong>Couches de fond :</strong>\r\n        <div style={{ marginTop: 8 }}>\r\n          <label style={{ marginRight: 20, display: 'inline-flex', alignItems: 'center' }}>\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={layersVisible.osm}\r\n              onChange={() => toggleLayer('osm')}\r\n              style={{ marginRight: 5 }}\r\n            />\r\n            OpenStreetMap\r\n          </label>\r\n          <label style={{ display: 'inline-flex', alignItems: 'center' }}>\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={layersVisible.shom}\r\n              onChange={() => toggleLayer('shom')}\r\n              style={{ marginRight: 5 }}\r\n            />\r\n            SHOM Scan Littoral\r\n          </label>\r\n        </div>\r\n        \r\n      </div>\r\n\r\n      {/* Saisie du fichier GIF */}\r\n      <input\r\n        type=\"file\"\r\n        accept=\"image/gif\"\r\n        onChange={handleGifUpload}\r\n        style={{ margin: '1em 0' }}\r\n      />\r\n\r\n      {/* Saisie manuelle des coordonnées */}\r\n      <div style={{ marginBottom: '1em', minHeight: 24 }}>\r\n        <label>\r\n          Latitude&nbsp;\r\n          <input\r\n            type=\"number\"\r\n            step=\"any\"\r\n            value={manualCoords.lat}\r\n            onChange={e => setManualCoords({ ...manualCoords, lat: e.target.value })}\r\n            style={{ width: 100, marginRight: 10 }}\r\n            placeholder=\"ex: 49.87\"\r\n          />\r\n        </label>\r\n        <label>\r\n          Longitude&nbsp;\r\n          <input\r\n            type=\"number\"\r\n            step=\"any\"\r\n            value={manualCoords.lng}\r\n            onChange={e => setManualCoords({ ...manualCoords, lng: e.target.value })}\r\n            style={{ width: 100 }}\r\n            placeholder=\"ex: -1.5\"\r\n          />\r\n        </label>\r\n      </div>\r\n\r\n      {pendingGif && (\r\n        <div style={{ margin: '1em 0' }}>\r\n          <span>GIF prêt à être superposé.</span>\r\n          <button onClick={handleValidateGif} style={{ marginLeft: 10 }}>\r\n            Valider\r\n          </button>\r\n        </div>\r\n      )}\r\n      <div\r\n        ref={mapContainerRef}\r\n        className=\"map-container\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Carte;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}