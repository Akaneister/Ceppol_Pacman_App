{"ast":null,"code":"import React,{useEffect}from\"react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const GestionAccesModal=_ref=>{let{accessModalRef,rapportSelectionne,operateurs,operateursAvecAcces,nouvelOperateurAcces,handleNouvelOperateurChange,ajouterAccesOperateur,retirerAccesOperateur,fermerGestionAcces,afficherAjoutHistorique,afficherHistorique,setAfficherAjoutHistorique,setAfficherHistorique,nouvelHistorique,handleHistoriqueChange,ajouterHistoriqueManuel,fetchHistorique,setHistoriqueData}=_ref;useEffect(()=>{if(accessModalRef!==null&&accessModalRef!==void 0&&accessModalRef.current){accessModalRef.current.classList.add('active');}// Correction: copie la valeur du ref dans une variable locale pour le cleanup\nconst modalElement=accessModalRef===null||accessModalRef===void 0?void 0:accessModalRef.current;return()=>{if(modalElement){modalElement.classList.remove('active');}};},[accessModalRef,rapportSelectionne]);if(!rapportSelectionne)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"modal\",ref:accessModalRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Gestion des acc\\xE8s au rapport\"}),/*#__PURE__*/_jsx(\"button\",{className:\"close-btn\",onClick:fermerGestionAcces,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Rapport: \",rapportSelectionne.titre]}),/*#__PURE__*/_jsxs(\"div\",{className:\"acces-form\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"nouvelOperateur\",children:\"Ajouter un op\\xE9rateur:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"acces-form-row\",children:[/*#__PURE__*/_jsxs(\"select\",{id:\"nouvelOperateur\",value:nouvelOperateurAcces,onChange:handleNouvelOperateurChange,className:\"select-operateur\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner un op\\xE9rateur\"}),operateurs.filter(op=>op.id_operateur!==rapportSelectionne.id_operateur&&!operateursAvecAcces.some(acc=>acc.id_operateur===op.id_operateur)).map(op=>/*#__PURE__*/_jsxs(\"option\",{value:op.id_operateur,children:[op.prenom,\" \",op.nom]},op.id_operateur))]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:ajouterAccesOperateur,disabled:!nouvelOperateurAcces,children:\"Ajouter\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"operateurs-acces-liste\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Op\\xE9rateurs ayant acc\\xE8s\"}),operateursAvecAcces.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Aucun op\\xE9rateur suppl\\xE9mentaire n'a acc\\xE8s \\xE0 ce rapport.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"acces-liste\",children:operateursAvecAcces.filter(op=>op.id_operateur!==rapportSelectionne.id_operateur).map(op=>/*#__PURE__*/_jsxs(\"div\",{className:\"acces-item\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"acces-avatar\",children:[op.prenom[0],op.nom[0]]}),/*#__PURE__*/_jsxs(\"span\",{className:\"acces-nom\",children:[op.prenom,\" \",op.nom]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger btn-sm\",onClick:()=>retirerAccesOperateur(op.id_operateur),title:\"Retirer l'acc\\xE8s\",children:\"Retirer\"})]},op.id_operateur))})]})]}),afficherAjoutHistorique&&/*#__PURE__*/_jsxs(\"div\",{className:\"ajout-historique-form\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ajouter un \\xE9l\\xE9ment d'historique\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"type_action\",children:\"Type d'action:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"type_action\",name:\"type_action\",value:nouvelHistorique.type_action,onChange:handleHistoriqueChange,className:\"form-control\",placeholder:\"Ex: OBSERVATION, INTERVENTION, SUIVI...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"detail_action\",children:\"D\\xE9tails:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"detail_action\",name:\"detail_action\",value:nouvelHistorique.detail_action,onChange:handleHistoriqueChange,className:\"form-control\",rows:\"4\",placeholder:\"D\\xE9crivez l'action ou l'observation en d\\xE9tail...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:ajouterHistoriqueManuel,children:\"Enregistrer\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>{setAfficherAjoutHistorique(false);setAfficherHistorique(true);},children:\"Annuler\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"modal-footer\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:fermerGestionAcces,children:\"Fermer\"})})]})});};export default GestionAccesModal;","map":{"version":3,"names":["React","useEffect","jsx","_jsx","jsxs","_jsxs","GestionAccesModal","_ref","accessModalRef","rapportSelectionne","operateurs","operateursAvecAcces","nouvelOperateurAcces","handleNouvelOperateurChange","ajouterAccesOperateur","retirerAccesOperateur","fermerGestionAcces","afficherAjoutHistorique","afficherHistorique","setAfficherAjoutHistorique","setAfficherHistorique","nouvelHistorique","handleHistoriqueChange","ajouterHistoriqueManuel","fetchHistorique","setHistoriqueData","current","classList","add","modalElement","remove","className","ref","children","onClick","titre","htmlFor","id","value","onChange","filter","op","id_operateur","some","acc","map","prenom","nom","disabled","length","title","type","name","type_action","placeholder","detail_action","rows"],"sources":["D:/Stage/MarineV3/frontend/src/components/pages/ListeRapport/GestionAccessModal.js"],"sourcesContent":["import React, { useEffect } from \"react\";\r\n\r\nconst GestionAccesModal = ({\r\n  accessModalRef,\r\n  rapportSelectionne,\r\n  operateurs,\r\n  operateursAvecAcces,\r\n  nouvelOperateurAcces,\r\n  handleNouvelOperateurChange,\r\n  ajouterAccesOperateur,\r\n  retirerAccesOperateur,\r\n  fermerGestionAcces,\r\n  afficherAjoutHistorique,\r\n  afficherHistorique,\r\n  setAfficherAjoutHistorique,\r\n  setAfficherHistorique,\r\n  nouvelHistorique,\r\n  handleHistoriqueChange,\r\n  ajouterHistoriqueManuel,\r\n  fetchHistorique,\r\n  setHistoriqueData,\r\n}) => {\r\n  useEffect(() => {\r\n    if (accessModalRef?.current) {\r\n      accessModalRef.current.classList.add('active');\r\n    }\r\n    // Correction: copie la valeur du ref dans une variable locale pour le cleanup\r\n    const modalElement = accessModalRef?.current;\r\n    return () => {\r\n      if (modalElement) {\r\n        modalElement.classList.remove('active');\r\n      }\r\n    };\r\n  }, [accessModalRef, rapportSelectionne]);\r\n\r\n  if (!rapportSelectionne) return null;\r\n\r\n  return (\r\n    <div className=\"modal\" ref={accessModalRef}>\r\n      <div className=\"modal-content\">\r\n        <div className=\"modal-header\">\r\n          <h2>Gestion des accès au rapport</h2>\r\n          <button className=\"close-btn\" onClick={fermerGestionAcces}>&times;</button>\r\n        </div>\r\n        <div className=\"modal-body\">\r\n          <div>\r\n            <h3>Rapport: {rapportSelectionne.titre}</h3>\r\n\r\n            <div className=\"acces-form\">\r\n              <label htmlFor=\"nouvelOperateur\">Ajouter un opérateur:</label>\r\n              <div className=\"acces-form-row\">\r\n                <select\r\n                  id=\"nouvelOperateur\"\r\n                  value={nouvelOperateurAcces}\r\n                  onChange={handleNouvelOperateurChange}\r\n                  className=\"select-operateur\"\r\n                >\r\n                  <option value=\"\">Sélectionner un opérateur</option>\r\n                  {operateurs\r\n                    .filter(\r\n                      (op) =>\r\n                        op.id_operateur !== rapportSelectionne.id_operateur &&\r\n                        !operateursAvecAcces.some((acc) => acc.id_operateur === op.id_operateur)\r\n                    )\r\n                    .map((op) => (\r\n                      <option key={op.id_operateur} value={op.id_operateur}>\r\n                        {op.prenom} {op.nom}\r\n                      </option>\r\n                    ))}\r\n                </select>\r\n                <button\r\n                  className=\"btn btn-primary\"\r\n                  onClick={ajouterAccesOperateur}\r\n                  disabled={!nouvelOperateurAcces}\r\n                >\r\n                  Ajouter\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"operateurs-acces-liste\">\r\n              <h3>Opérateurs ayant accès</h3>\r\n              {operateursAvecAcces.length === 0 ? (\r\n                <p>Aucun opérateur supplémentaire n'a accès à ce rapport.</p>\r\n              ) : (\r\n                <div className=\"acces-liste\">\r\n                  {operateursAvecAcces\r\n                    .filter((op) => op.id_operateur !== rapportSelectionne.id_operateur)\r\n                    .map((op) => (\r\n                      <div className=\"acces-item\" key={op.id_operateur}>\r\n                        <span className=\"acces-avatar\">\r\n                          {op.prenom[0]}\r\n                          {op.nom[0]}\r\n                        </span>\r\n                        <span className=\"acces-nom\">\r\n                          {op.prenom} {op.nom}\r\n                        </span>\r\n                        <button\r\n                          className=\"btn btn-danger btn-sm\"\r\n                          onClick={() => retirerAccesOperateur(op.id_operateur)}\r\n                          title=\"Retirer l'accès\"\r\n                        >\r\n                          Retirer\r\n                        </button>\r\n                      </div>\r\n                    ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {afficherAjoutHistorique && (\r\n            <div className=\"ajout-historique-form\">\r\n              <h3>Ajouter un élément d'historique</h3>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"type_action\">Type d'action:</label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"type_action\"\r\n                  name=\"type_action\"\r\n                  value={nouvelHistorique.type_action}\r\n                  onChange={handleHistoriqueChange}\r\n                  className=\"form-control\"\r\n                  placeholder=\"Ex: OBSERVATION, INTERVENTION, SUIVI...\"\r\n                />\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"detail_action\">Détails:</label>\r\n                <textarea\r\n                  id=\"detail_action\"\r\n                  name=\"detail_action\"\r\n                  value={nouvelHistorique.detail_action}\r\n                  onChange={handleHistoriqueChange}\r\n                  className=\"form-control\"\r\n                  rows=\"4\"\r\n                  placeholder=\"Décrivez l'action ou l'observation en détail...\"\r\n                ></textarea>\r\n              </div>\r\n              <div className=\"form-actions\">\r\n                <button className=\"btn btn-primary\" onClick={ajouterHistoriqueManuel}>\r\n                  Enregistrer\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-secondary\"\r\n                  onClick={() => {\r\n                    setAfficherAjoutHistorique(false);\r\n                    setAfficherHistorique(true);\r\n                  }}\r\n                >\r\n                  Annuler\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"modal-footer\">\r\n          <button className=\"btn btn-primary\" onClick={fermerGestionAcces}>\r\n            Fermer\r\n          </button>\r\n          \r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GestionAccesModal;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}