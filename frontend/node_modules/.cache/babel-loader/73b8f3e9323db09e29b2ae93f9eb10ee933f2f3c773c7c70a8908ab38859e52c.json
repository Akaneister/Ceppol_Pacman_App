{"ast":null,"code":"import React from\"react\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const GestionAccesModal=_ref=>{let{accessModalRef,rapportSelectionne,operateurs,operateursAvecAcces,nouvelOperateurAcces,handleNouvelOperateurChange,ajouterAccesOperateur,retirerAccesOperateur,fermerGestionAcces,afficherAjoutHistorique,afficherHistorique,setAfficherAjoutHistorique,setAfficherHistorique,nouvelHistorique,handleHistoriqueChange,ajouterHistoriqueManuel,fetchHistorique,setHistoriqueData}=_ref;if(!rapportSelectionne)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"modal\",ref:accessModalRef,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Gestion des acc\\xE8s au rapport\"}),/*#__PURE__*/_jsx(\"button\",{className:\"close-btn\",onClick:fermerGestionAcces,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"Rapport: \",rapportSelectionne.titre]}),/*#__PURE__*/_jsxs(\"div\",{className:\"acces-form\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"nouvelOperateur\",children:\"Ajouter un op\\xE9rateur:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"acces-form-row\",children:[/*#__PURE__*/_jsxs(\"select\",{id:\"nouvelOperateur\",value:nouvelOperateurAcces,onChange:handleNouvelOperateurChange,className:\"select-operateur\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner un op\\xE9rateur\"}),operateurs.filter(op=>op.id_operateur!==rapportSelectionne.id_operateur&&!operateursAvecAcces.some(acc=>acc.id_operateur===op.id_operateur)).map(op=>/*#__PURE__*/_jsxs(\"option\",{value:op.id_operateur,children:[op.prenom,\" \",op.nom]},op.id_operateur))]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:ajouterAccesOperateur,disabled:!nouvelOperateurAcces,children:\"Ajouter\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"operateurs-acces-liste\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Op\\xE9rateurs ayant acc\\xE8s\"}),operateursAvecAcces.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Aucun op\\xE9rateur suppl\\xE9mentaire n'a acc\\xE8s \\xE0 ce rapport.\"}):/*#__PURE__*/_jsxs(\"table\",{className:\"acces-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Op\\xE9rateur\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:operateursAvecAcces.filter(op=>op.id_operateur!==rapportSelectionne.id_operateur)// exclure l'opérateur principal\n.map(op=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{children:[op.prenom,\" \",op.nom]}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger btn-sm\",onClick:()=>retirerAccesOperateur(op.id_operateur),children:\"Retirer\"})})]},op.id_operateur))})]})]})]}),afficherAjoutHistorique&&/*#__PURE__*/_jsxs(\"div\",{className:\"ajout-historique-form\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ajouter un \\xE9l\\xE9ment d'historique\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"type_action\",children:\"Type d'action:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"type_action\",name:\"type_action\",value:nouvelHistorique.type_action,onChange:handleHistoriqueChange,className:\"form-control\",placeholder:\"Ex: OBSERVATION, INTERVENTION, SUIVI...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"detail_action\",children:\"D\\xE9tails:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"detail_action\",name:\"detail_action\",value:nouvelHistorique.detail_action,onChange:handleHistoriqueChange,className:\"form-control\",rows:\"4\",placeholder:\"D\\xE9crivez l'action ou l'observation en d\\xE9tail...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:ajouterHistoriqueManuel,children:\"Enregistrer\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>{setAfficherAjoutHistorique(false);setAfficherHistorique(true);},children:\"Annuler\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:fermerGestionAcces,children:\"Fermer\"}),!afficherHistorique&&!afficherAjoutHistorique&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:async()=>{setAfficherHistorique(true);const historique=await fetchHistorique(rapportSelectionne.id_rapport);setHistoriqueData(historique);},children:\"Voir l'historique\"})]})]})});};export default GestionAccesModal;","map":{"version":3,"names":["React","jsx","_jsx","jsxs","_jsxs","GestionAccesModal","_ref","accessModalRef","rapportSelectionne","operateurs","operateursAvecAcces","nouvelOperateurAcces","handleNouvelOperateurChange","ajouterAccesOperateur","retirerAccesOperateur","fermerGestionAcces","afficherAjoutHistorique","afficherHistorique","setAfficherAjoutHistorique","setAfficherHistorique","nouvelHistorique","handleHistoriqueChange","ajouterHistoriqueManuel","fetchHistorique","setHistoriqueData","className","ref","children","onClick","titre","htmlFor","id","value","onChange","filter","op","id_operateur","some","acc","map","prenom","nom","disabled","length","type","name","type_action","placeholder","detail_action","rows","historique","id_rapport"],"sources":["D:/Stage/MarineV3/frontend/src/components/pages/ListeRapport/GestionAccessModal.js"],"sourcesContent":["import React from \"react\";\r\n\r\nconst GestionAccesModal = ({\r\n  accessModalRef,\r\n  rapportSelectionne,\r\n  operateurs,\r\n  operateursAvecAcces,\r\n  nouvelOperateurAcces,\r\n  handleNouvelOperateurChange,\r\n  ajouterAccesOperateur,\r\n  retirerAccesOperateur,\r\n  fermerGestionAcces,\r\n  afficherAjoutHistorique,\r\n  afficherHistorique,\r\n  setAfficherAjoutHistorique,\r\n  setAfficherHistorique,\r\n  nouvelHistorique,\r\n  handleHistoriqueChange,\r\n  ajouterHistoriqueManuel,\r\n  fetchHistorique,\r\n  setHistoriqueData,\r\n}) => {\r\n  if (!rapportSelectionne) return null;\r\n\r\n  return (\r\n    <div className=\"modal\" ref={accessModalRef}>\r\n      <div className=\"modal-content\">\r\n        <div className=\"modal-header\">\r\n          <h2>Gestion des accès au rapport</h2>\r\n          <button className=\"close-btn\" onClick={fermerGestionAcces}>&times;</button>\r\n        </div>\r\n        <div className=\"modal-body\">\r\n          <div>\r\n            <h3>Rapport: {rapportSelectionne.titre}</h3>\r\n\r\n            <div className=\"acces-form\">\r\n              <label htmlFor=\"nouvelOperateur\">Ajouter un opérateur:</label>\r\n              <div className=\"acces-form-row\">\r\n                <select\r\n                  id=\"nouvelOperateur\"\r\n                  value={nouvelOperateurAcces}\r\n                  onChange={handleNouvelOperateurChange}\r\n                  className=\"select-operateur\"\r\n                >\r\n                  <option value=\"\">Sélectionner un opérateur</option>\r\n                  {operateurs\r\n                    .filter(\r\n                      (op) =>\r\n                        op.id_operateur !== rapportSelectionne.id_operateur &&\r\n                        !operateursAvecAcces.some((acc) => acc.id_operateur === op.id_operateur)\r\n                    )\r\n                    .map((op) => (\r\n                      <option key={op.id_operateur} value={op.id_operateur}>\r\n                        {op.prenom} {op.nom}\r\n                      </option>\r\n                    ))}\r\n                </select>\r\n                <button\r\n                  className=\"btn btn-primary\"\r\n                  onClick={ajouterAccesOperateur}\r\n                  disabled={!nouvelOperateurAcces}\r\n                >\r\n                  Ajouter\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"operateurs-acces-liste\">\r\n              <h3>Opérateurs ayant accès</h3>\r\n              {operateursAvecAcces.length === 0 ? (\r\n                <p>Aucun opérateur supplémentaire n'a accès à ce rapport.</p>\r\n              ) : (\r\n                <table className=\"acces-table\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>Opérateur</th>\r\n                      <th>Action</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {operateursAvecAcces\r\n                      .filter((op) => op.id_operateur !== rapportSelectionne.id_operateur) // exclure l'opérateur principal\r\n                      .map((op) => (\r\n                        <tr key={op.id_operateur}>\r\n                          <td>\r\n                            {op.prenom} {op.nom}\r\n                          </td>\r\n                          <td>\r\n                            <button\r\n                              className=\"btn btn-danger btn-sm\"\r\n                              onClick={() => retirerAccesOperateur(op.id_operateur)}\r\n                            >\r\n                              Retirer\r\n                            </button>\r\n                          </td>\r\n                        </tr>\r\n                      ))}\r\n                  </tbody>\r\n                </table>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {afficherAjoutHistorique && (\r\n            <div className=\"ajout-historique-form\">\r\n              <h3>Ajouter un élément d'historique</h3>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"type_action\">Type d'action:</label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"type_action\"\r\n                  name=\"type_action\"\r\n                  value={nouvelHistorique.type_action}\r\n                  onChange={handleHistoriqueChange}\r\n                  className=\"form-control\"\r\n                  placeholder=\"Ex: OBSERVATION, INTERVENTION, SUIVI...\"\r\n                />\r\n              </div>\r\n              <div className=\"form-group\">\r\n                <label htmlFor=\"detail_action\">Détails:</label>\r\n                <textarea\r\n                  id=\"detail_action\"\r\n                  name=\"detail_action\"\r\n                  value={nouvelHistorique.detail_action}\r\n                  onChange={handleHistoriqueChange}\r\n                  className=\"form-control\"\r\n                  rows=\"4\"\r\n                  placeholder=\"Décrivez l'action ou l'observation en détail...\"\r\n                ></textarea>\r\n              </div>\r\n              <div className=\"form-actions\">\r\n                <button className=\"btn btn-primary\" onClick={ajouterHistoriqueManuel}>\r\n                  Enregistrer\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-secondary\"\r\n                  onClick={() => {\r\n                    setAfficherAjoutHistorique(false);\r\n                    setAfficherHistorique(true);\r\n                  }}\r\n                >\r\n                  Annuler\r\n                </button>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"modal-footer\">\r\n          <button className=\"btn btn-primary\" onClick={fermerGestionAcces}>\r\n            Fermer\r\n          </button>\r\n          {!afficherHistorique && !afficherAjoutHistorique && (\r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              onClick={async () => {\r\n                setAfficherHistorique(true);\r\n                const historique = await fetchHistorique(rapportSelectionne.id_rapport);\r\n                setHistoriqueData(historique);\r\n              }}\r\n            >\r\n              Voir l'historique\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GestionAccesModal;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}